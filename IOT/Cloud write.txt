import datetime
from datetime import datetime
import RPi.GPIO as GPIO
import time
import decimal
import http.client as httplib, urllib
import time
import subprocess
import sys
import Adafruit_DHT

sleep = 2 # how many seconds to sleep between posts to the channel
key = '***************'  # Thingspeak channel to update

while True:
    time.sleep(5)
    humidity, temperature = Adafruit_DHT.read_retry(11,21)
    print (temperature, humidity)
   
    params = urllib.parse.urlencode({'field1':temperature,'field2':humidity,'key':key})
    headers = {"Content-typZZe": "application/x-www-form-urlencoded","Accept": "text/plain"}
    conn = httplib.HTTPConnection("api.thingspeak.com:80")
    try:
        conn.request("POST", "/update", params, headers)
        response = conn.getresponse()
        print (response.status, response.reason)
        data = response.read()
        conn.close()
    except:
        print ("connection failed")




